<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Omsgr Catering Services | Professional Culinary Excellence</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--primary:#C2410C;
--gold:#FBBF24;
--dark:#0F172A;
--light:#F8FAFC;
--white:#fff;
--gray:#64748B;
--border:#E2E8F0;
}

body{
font-family:'Plus Jakarta Sans',sans-serif;
background:var(--light);
color:#1E293B;
line-height:1.6;
overflow-x:hidden;
}

/* ================= HEADER ================= */
header{
background:#fff;
position:sticky;
top:0;
z-index:100;
border-bottom:3px solid var(--primary);
box-shadow:0 5px 20px rgba(0,0,0,.05);
width:100%;
}

nav{
max-width:1200px;
margin:auto;
padding:12px 20px;
display:flex;
justify-content:space-between;
align-items:center;
gap:14px;
flex-wrap:wrap;
}

.logo-section{
display:flex;
align-items:center;
gap:12px;
flex-shrink:0;
}

.logo{
display:flex;
align-items:center;
gap:8px;
flex-shrink:0;
}

.logo img{
height:42px;
width:42px;
border-radius:8px;
border:2px solid var(--primary);
padding:2px;
object-fit:contain;
}

.heading-title{
font-size:18px;
font-weight:800;
color:var(--dark);
white-space:nowrap;
text-align:left;
}

.location-tag{
font-size:13px;
font-weight:600;
color:var(--gray);
background:var(--light);
padding:8px 14px;
border-radius:8px;
white-space:nowrap;
flex-shrink:0;
}

/* ================= HERO ================= */
.hero{
position:relative;
height:440px; /* SMALLER ON WINDOWS */
display:flex;
align-items:center;
justify-content:center;
text-align:center;
color:#fff;
overflow:hidden;
}

.hero-slider{position:absolute;inset:0}
.slide{
position:absolute;
inset:0;
opacity:0;
transition:opacity 1.5s ease;
background-size:cover;
background-position:center;
}
.slide.active{opacity:1}
.slide::after{
content:'';
position:absolute;
inset:0;
background:linear-gradient(120deg,rgba(15,23,42,.75),rgba(15,23,42,.85));
}

.hero-content{position:relative;z-index:2;padding:20px}
.hero h1{font-size:clamp(26px,5vw,44px);font-weight:800;margin-bottom:14px}
.hero p{font-size:clamp(14px,2vw,18px);max-width:600px;margin:auto auto 26px}

.rating{
display:inline-flex;
gap:8px;
align-items:center;
background:rgba(255,255,255,.15);
padding:8px 18px;
border-radius:50px;
margin-bottom:18px;
border:1px solid rgba(255,255,255,.2);
}
.rating span{color:var(--gold)}

.btn{
padding:18px 30px;
border-radius:18px;
font-weight:700;
text-decoration:none;
display:inline-block;
}
.btn-primary{
background:linear-gradient(135deg,#C2410C,#F97316);
color:#fff;
}

/* ================= CHEF ================= */
.chef{
max-width:1100px;
margin:-35px auto 60px;
background:#fff;
display:flex;
border-radius:18px;
overflow:hidden;
box-shadow:0 20px 40px rgba(0,0,0,.12);
z-index:5;
position:relative;
}

.chef-img{
flex:1;
background:url('static/Gemini_Generated_Image_sv43nosv43nosv43.png') center/cover;
min-height:280px;
}

.chef-info{
flex:1.4;
padding:50px;
}

.badge{
background:#FFF7ED;
color:var(--primary);
font-size:11px;
font-weight:700;
padding:8px 14px;
border-radius:8px;
display:inline-block;
margin-bottom:14px;
}

/* ================= WHY CHOOSE US ================= */
/* ================= CENTERED SECTION STYLING ================= */

.why {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 80px 20px; /* Added more vertical space for a premium feel */
    text-align: center; /* Centers the H2 and the inline items */
}

.why h2 {
    font-size: clamp(1.75rem, 5vw, 2.5rem);
    font-weight: 800;
    margin-bottom: 50px;
    position: relative;
    display: inline-block; /* Allows us to add an underline decorator if needed */
}

/* Optional: Decorative line under the centered heading */
.why h2::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 25%;
    right: 25%;
    height: 4px;
    background: var(--primary-gradient);
    border-radius: 10px;
}

.why-minimal-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center; /* Centers the items horizontally */
    align-items: flex-start; /* Aligns items to the top of the flex row */
    gap: 40px;
    margin: 0 auto;
    max-width: 1000px;
}

.why-item {
    flex: 1 1 200px;
    max-width: 240px; /* Prevents items from getting too wide on desktop */
    display: flex;
    flex-direction: column;
    align-items: center; /* Centers the icon, h4, and p internally */
    text-align: center;
}

/* ================= MOBILE ADJUSTMENTS ================= */

@media (max-width: 768px) {
    .why {
        padding: 50px 15px;
    }
    
    .why-minimal-grid {
        gap: 30px;
    }

    .why-item {
        flex: 1 1 140px; /* Ensures 2 items per row on mobile */
    }
}

/* Staggered Animation Trigger */
.reveal.active .why-item {
    opacity: 1;
    transform: translateY(0);
}

.reveal.active .why-item:nth-child(1) { transition-delay: 0.1s; }
.reveal.active .why-item:nth-child(2) { transition-delay: 0.2s; }
.reveal.active .why-item:nth-child(3) { transition-delay: 0.3s; }
.reveal.active .why-item:nth-child(4) { transition-delay: 0.4s; }

.why-icon-wrap {
    font-size: 40px; /* Larger icons */
    margin-bottom: 20px;
    display: inline-block;
    transition: transform 0.3s ease;
}

.why-item:hover .why-icon-wrap {
    transform: scale(1.2) rotate(5deg); /* Playful movement on hover */
}

.why-item h4 {
    font-size: 18px;
    font-weight: 800;
    color: var(--dark);
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.why-item p {
    font-size: 14px;
    color: var(--gray);
    line-height: 1.5;
}

/* ================= MOBILE RESPONSIVE ================= */

@media (max-width: 768px) {
    .why-minimal-grid {
        gap: 25px;
    }
    
    .why-item {
        flex: 1 1 40%; /* 2 items per row on tablet/mobile */
        max-width: 100%;
    }
}

@media (max-width: 480px) {
    .why-item h4 {
        font-size: 15px;
    }
    
    .why-item p {
        font-size: 12px;
    }
    
    .why-icon-wrap {
        font-size: 32px;
    }
}

/* ================= MENU ================= */
.menu{
max-width:1200px;
margin:auto;
padding:40px 20px;
text-align:center;
}

/* ================= FOOTER ================= */
footer{
background:var(--dark);
color:#fff;
padding:25px 15px;
text-align:center;
width:100%;
position:relative;
}

/* ================= RESPONSIVE ================= */
@media(max-width:768px){
nav{
padding:10px 15px;
gap:10px;
}

.hero{height:380px}

.chef{
flex-direction:column;
margin:-30px 15px 50px;
max-width:100%;
}

.chef-info{
padding:30px 22px;
flex:1;
}

.chef-img{
min-height:200px;
flex:1;
}

.why-grid{
grid-template-columns:repeat(4,1fr);
gap:10px;
}

.why-card{
padding:15px 10px;
}

.why-card h4{
font-size:12px;
}

.why-card p{
font-size:11px;
}

.menu{
padding:30px 15px;
}

.grid{
gap:12px;
padding:8px 2px;
}
}

@media(max-width:480px){
nav{
padding:8px 12px;
}

.logo img{
height:32px;
width:32px;
}

.heading-title{
font-size:15px;
}

.location-tag{
font-size:12px;
padding:6px 12px;
margin-top:6px;
}

.hero{
height:320px;
padding:15px;
}

.hero h1{
font-size:24px;
margin-bottom:12px;
}

.hero p{
font-size:14px;
margin-bottom:20px;
}

.btn{
padding:12px 24px;
font-size:14px;
}

.chef{
margin:-20px 10px 40px;
}

.chef-info{
padding:25px 18px;
}

.badge{
font-size:10px;
padding:6px 10px;
}

.why{
padding:40px 15px 15px;
}

.why h2{
font-size:24px;
margin-bottom:30px;
}

.why-grid{
grid-template-columns:repeat(4,1fr);
gap:8px;
}

.why-card{
padding:12px 8px;
}

.why-card h4{
font-size:11px;
}

.why-card p{
font-size:10px;
}

.menu{
padding:25px 12px;
}

.menu h2{
font-size:22px;
margin-bottom:20px;
}

.grid{
gap:10px;
}

.card{
min-width:130px;
max-width:150px;
}

.card img{
height:100px;
}

.card-body{
padding:8px;
}

.card h3{
font-size:12px;
}

.card p{
font-size:10px;
}

.price{
font-size:12px;
}
}


/* ================= MENU / SIGNATURE DISHES ================= */
.menu{
max-width:1200px;
margin:auto;
padding:40px 20px;
text-align:center;
}

.menu h2{
font-size:clamp(24px,4vw,30px);
font-weight:800;
margin-bottom:30px;
}

.grid{
display:flex;
gap:14px;
overflow-x:auto;
padding:10px 2px;
scrollbar-width:none;
-ms-overflow-style:none;
}

.grid::-webkit-scrollbar{display:none}

.card{
background:#fff;
border:2px solid var(--primary);
border-radius:14px;
min-width:170px;     /* SMALL CARD */
max-width:190px;
overflow:hidden;
transition:.3s;
flex-shrink:0;
animation: pulse 2s infinite;
}

.card:hover{
transform:translateY(-4px);
border-color:var(--primary);
box-shadow:0 10px 25px rgba(0,0,0,.12);
}

.card img{
width:100%;
height:120px;
object-fit:cover;
}

.card-body{
padding:10px;
text-align:left;
}

.card h3{
font-size:13px;
font-weight:700;
margin-bottom:4px;
line-height:1.3;
}

.card p{
font-size:11px;
color:var(--gray);
margin-bottom:6px;
}

.price{
font-size:13px;
font-weight:800;
color:var(--primary);
}

/* ================= FOOTER ================= */
footer{
background:var(--dark);
color:#fff;
padding:30px 15px 20px;
}

.footer-content{
max-width:1200px;
margin:auto;
text-align:center;
}

.footer-links{
display:flex;
justify-content:center;
gap:20px;
flex-wrap:wrap;
margin-bottom:20px;
}

.footer-link{
display:flex;
align-items:center;
gap:6px;
color:#CBD5E1;
font-size:13px;
text-decoration:none;
padding:8px 14px;
border-radius:6px;
transition:.3s;
}

.footer-link:hover{
background:rgba(255,255,255,.08);
color:#fff;
}

.social{
display:flex;
justify-content:center;
gap:14px;
margin-bottom:20px;
flex-wrap:wrap;
}

.social a{
width:42px;
height:42px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
background:linear-gradient(135deg,#C2410C,#F97316);
color:#fff;
transition:.3s;
}

.social a:hover{
transform:translateY(-3px) scale(1.05);
box-shadow:0 6px 18px rgba(194,65,12,.5);
}

.social-icon{
width:20px;
height:20px;
fill:currentColor;
}

.footer-bottom{
border-top:1px solid rgba(255,255,255,.1);
padding-top:15px;
margin-top:10px;
}

.copyright{
font-size:13px;
color:#94A3B8;
}

/* ================= RESPONSIVE FIXES ================= */
@media(max-width:768px){
.card{
min-width:150px;
max-width:170px;
}

.card img{
height:110px;
}

.footer-links{
gap:10px;
}

.footer-link{
font-size:12px;
}
}

@media(max-width:480px){
.card{
min-width:140px;
max-width:160px;
}

.footer-link{
font-size:11px;
padding:6px 10px;
}
}

/* ================= MOBILE HEADER FIX ================= */
@media (max-width: 768px) {
  nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
  }

  .logo-section {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
    order: 1; /* Move to left side */
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
  }

  .logo img {
    height: 32px;
    width: 32px;
  }

  .heading-title {
    font-size: 15px;
    white-space: nowrap;
  }

  .location-tag {
    font-size: 12px;
    padding: 6px 10px;
    flex-shrink: 0;
    order: 2; /* Move to right side */
    margin-left: auto; /* Push to right */
  }
}



</style>
</head>

<body>

<header>
<nav>
<div class="logo-section">
<div class="logo">
<img src="static/WhatsApp Image 2026-01-21 at 10.54.12 (1).jpeg" alt="Omsgr Catering Services">
</div>
<div class="heading-title">Omsgr Catrings</div>
</div>
<div class="location-tag">üìç Siddakatte,KA</div>
</nav>
</header>

<section class="hero reveal">
    <div class="hero-slider">
        <div class="slide active" style="background-image: url('https://images.unsplash.com/photo-1555244162-803834f70033?auto=format&fit=crop&w=1600&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1600&q=80')"></div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1414235077428-338989a2e8c0?auto=format&fit=crop&w=1600&q=80')"></div>
    </div>

<div class="hero-content">

    <!-- ‚≠ê DYNAMIC RATING BUTTON -->
    <button onclick="openRatingModal()"
        style="
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            margin-bottom: 20px;
            color: #fff;
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
        ">
        <span id="ratingStars"
              style="color:#ffc107; font-size:18px; letter-spacing:2px;">
            ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
        </span>
        <span id="ratingText"
              style="font-size:14px; margin-left:6px;">
            Loading rating...
        </span>
    </button>

    <h1>Premium Culinary Excellence</h1>
    <p>Authentic flavors crafted for unforgettable celebrations</p>
    <a href="/services" class="btn btn-primary">Book Your Event</a>

</div>

</section>

<section class="chef reveal">
<div class="chef-img"></div>
<div class="chef-info">
<span class="badge">Master of Flavors</span>
<h2>Chef Chetan Poojary</h2>
<p>"Every dish carries tradition, passion, and perfection. We bring the restaurant experience to your home."</p>
<div style="margin-top: 15px; display: flex; gap: 15px; font-size: 13px; font-weight: 600;">
    <span>üìç Siddakatte</span>
    <span>üèÜ Award Winning</span>
</div>
</div>
</section>

<section class="why reveal">
    <h2>Why Choose Us</h2>
    <div class="why-minimal-grid">
        <div class="why-item">
            <div class="why-icon-wrap">üë®‚Äçüç≥</div>
            <h4>Expert Chefs</h4>
            <p>Led by Chef Chetan with 15+ years of culinary mastery.</p>
        </div>
        <div class="why-item">
            <div class="why-icon-wrap">üéâ</div>
            <h4>Any Event</h4>
            <p>From grand weddings to intimate private house parties.</p>
        </div>
        <div class="why-item">
            <div class="why-icon-wrap">‚è±</div>
            <h4>On-Time Delivery</h4>
            <p>Strict punctuality so your guests are never kept waiting.</p>
        </div>
        <div class="why-item">
            <div class="why-icon-wrap">üí∞</div>
            <h4>Affordable Luxury</h4>
            <p>Premium food quality at prices that fit your budget.</p>
        </div>
    </div>
</section>

<section class="menu reveal">
<h2>Our Signature Dishes</h2>
<div class="grid" id="dishGrid"></div>
<div style="text-align:center;margin-top:20px;"><a href="/menu" class="btn btn-primary">View Full Menu</a></div>
</section>

<footer class="reveal">
<div class="footer-content">
    <div class="footer-links">
        <a href="#" class="footer-link" onclick="openLocation()">
            <i class="fas fa-map-marker-alt"></i>
            <span>Siddakatte, Karnataka</span>
        </a>
        <a href="#" class="footer-link" onclick="contactChef()">
            <i class="fas fa-user-tie"></i>
            <span>Chef Chetan</span>
        </a>
        <a href="#" class="footer-link" onclick="contactDeveloper()">
            <i class="fas fa-code"></i>
            <span>Developer</span>
        </a>
    </div>

<div class="social">
  <!-- Instagram -->
  <a href="https://instagram.com/chetan_catering" target="_blank"
     title="Follow us on Instagram" aria-label="Instagram">
    <svg viewBox="0 0 24 24" class="social-icon instagram">
      <path d="M7 2C4.243 2 2 4.243 2 7v10c0 2.757 2.243 5 5 5h10c2.757 0 5-2.243 5-5V7c0-2.757-2.243-5-5-5H7zm10 2a3 3 0 013 3v10a3 3 0 01-3 3H7a3 3 0 01-3-3V7a3 3 0 013-3h10zm-5 3a5 5 0 100 10 5 5 0 000-10zm0 2a3 3 0 110 6 3 3 0 010-6zm5.5-.75a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0z"/>
    </svg>
  </a>

  <!-- WhatsApp -->
  <a href="https://wa.me/917338221281" target="_blank"
     title="Contact us on WhatsApp" aria-label="WhatsApp">
    <svg viewBox="0 0 24 24" class="social-icon whatsapp">
      <path d="M12 2a10 10 0 00-8.94 14.5L2 22l5.65-1.98A10 10 0 1012 2zm0 2a8 8 0 017.94 9.06A8 8 0 014.93 6.06 8 8 0 0112 4zm4.52 11.18c-.25.7-1.48 1.36-2.03 1.44-.5.07-1.14.1-1.84-.12-.42-.14-.96-.31-1.65-.6-2.9-1.25-4.8-4.18-4.95-4.38-.15-.2-1.18-1.57-1.18-3 0-1.43.75-2.13 1.02-2.42.27-.29.6-.36.8-.36.2 0 .4 0 .57.01.18.01.42-.07.66.5.25.6.85 2.08.93 2.23.07.15.12.33.02.53-.1.2-.15.33-.3.5-.15.18-.32.4-.45.54-.15.15-.31.31-.13.61.18.3.8 1.32 1.72 2.13 1.18 1.05 2.18 1.38 2.48 1.53.3.15.48.13.66-.08.18-.2.75-.87.95-1.17.2-.3.4-.25.66-.15.27.1 1.7.8 1.99.95.3.15.5.22.57.34.07.12.07.7-.18 1.4z"/>
    </svg>
  </a>

  <!-- Facebook -->
  <a href="https://facebook.com/chetan.catering.services" target="_blank"
     title="Like us on Facebook" aria-label="Facebook">
    <svg viewBox="0 0 24 24" class="social-icon facebook">
      <path d="M22 12a10 10 0 10-11.5 9.87v-6.99H8.08V12h2.42V9.8c0-2.4 1.43-3.73 3.62-3.73 1.05 0 2.15.19 2.15.19v2.36h-1.21c-1.2 0-1.57.74-1.57 1.5V12h2.67l-.43 2.88h-2.24v6.99A10 10 0 0022 12z"/>
    </svg>
  </a>
</div>


    <div class="footer-bottom">
        <div class="copyright">¬© 2026 Chetan Catering Services</div>

    </div>
</div>
</footer>

<script>
/* Hero Image Slider */
const slides = document.querySelectorAll('.slide');
let currentSlide = 0;
function nextSlide() {
    if(slides.length === 0) return;
    slides[currentSlide].classList.remove('active');
    currentSlide = (currentSlide + 1) % slides.length;
    slides[currentSlide].classList.add('active');
}
setInterval(nextSlide, 5000);

/* Scroll Reveal */
const reveal=document.querySelectorAll(".reveal");
const onScroll=()=>reveal.forEach(e=>{
if(e.getBoundingClientRect().top<window.innerHeight-80)e.classList.add("active");
});
window.addEventListener("scroll",onScroll);onScroll();

/* Dishes Logic */
fetch("/api/dishes/signature")
.then(r=>r.json())
.then(data=>{
if(data.success && data.dishes){
const g=document.getElementById("dishGrid");
data.dishes.forEach(x=>{
g.innerHTML+=`
<div class="card">
<img src="${x.image_url}">
<div class="card-body">
<h3>${x.name}</h3>
<p>${x.category || x.description}</p>
<div class="price">‚Çπ${x.price}</div>
</div></div>`;
});

// Auto-scroll animation
let scrollDirection = 1; // 1 = right, -1 = left
let scrollSpeed = 1;
let scrollInterval;

function startAutoScroll() {
    scrollInterval = setInterval(() => {
        const container = g;
        const maxScrollLeft = container.scrollWidth - container.clientWidth;

        if (container.scrollLeft >= maxScrollLeft && scrollDirection === 1) {
            scrollDirection = -1; // Change direction to left
        } else if (container.scrollLeft <= 0 && scrollDirection === -1) {
            scrollDirection = 1; // Change direction to right
        }

        container.scrollLeft += scrollSpeed * scrollDirection;
    }, 50);
}

function stopAutoScroll() {
    clearInterval(scrollInterval);
}

// Start auto-scroll when page loads
startAutoScroll();

// Pause on hover
g.addEventListener('mouseenter', stopAutoScroll);
g.addEventListener('mouseleave', startAutoScroll);

// Touch/swipe support for mobile
let startX;
let scrollLeft;

g.addEventListener('touchstart', (e) => {
    startX = e.touches[0].pageX - g.offsetLeft;
    scrollLeft = g.scrollLeft;
    stopAutoScroll();
});

g.addEventListener('touchmove', (e) => {
    if (!startX) return;
    const x = e.touches[0].pageX - g.offsetLeft;
    const walk = (x - startX) * 2;
    g.scrollLeft = scrollLeft - walk;
});

g.addEventListener('touchend', () => {
    startX = null;
    startAutoScroll();
});
}
});

/* Footer Functions */
function openLocation() {
    // Open Google Maps with exact location
    const address = "2434+R95 Padapu S.C. Colony, Karnataka";
    const encodedAddress = encodeURIComponent(address);
    window.open(`https://www.google.com/maps/search/?api=1&query=${encodedAddress}`, '_blank');
}

function contactChef() {
    // Open WhatsApp with a pre-filled message
    const phone = "917338221281";
    const message = encodeURIComponent("Hii Chef Chetan, I would like to inquire about your catering services.");
    window.open(`https://wa.me/${phone}?text=${message}`, '_blank');
}

function contactDeveloper() {
    // Open Gmail compose with pre-filled fields
    const email = "kulaladarsh1@gmail.com";
    const subject = encodeURIComponent("Freelance Development Inquiry");
    const body = encodeURIComponent("Hi Adarsh,\n\nI came across your work on the Chetan Catering Services website and I'm interested in your freelance development services.\n\nPlease let me know your availability and rates.\n\nBest regards,");
    window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${email}&su=${subject}&body=${body}`, '_blank');
}

/* Dynamic Rating Display */
function loadAverageRating() {
    console.log('Loading average rating...');
    fetch('/api/bookings/ratings-average')
        .then(res => {
            console.log('API response status:', res.status);
            return res.json();
        })
        .then(data => {
            console.log('API response data:', data);
            if (!data.success) {
                // Show error state
                updateHeroRatingDisplay(null, 0, 'Unable to load ratings');
                return;
            }

            if (data.average_rating === null) {
                // No ratings yet
                updateHeroRatingDisplay(null, 0, 'Be the first to rate!');
                return;
            }

            const avg = Number(data.average_rating);
            const count = data.total_ratings || 0;

            updateHeroRatingDisplay(avg, count);
        })
        .catch(error => {
            console.log('Rating API failed:', error);
            updateHeroRatingDisplay(null, 0, 'Unable to load ratings');
        });
}

function updateHeroRatingDisplay(avg, count, message = null) {
    const starsEl = document.getElementById('ratingStars');
    const textEl = document.getElementById('ratingText');

    if (!starsEl || !textEl) return;

    if (message) {
        // Show custom message (error or no ratings)
        starsEl.textContent = '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ';
        textEl.textContent = message;
        return;
    }

    if (avg === null || count === 0) {
        // No ratings yet
        starsEl.textContent = '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ';
        textEl.textContent = 'Be the first to rate!';
        return;
    }

    // Show actual rating
    const full = Math.floor(avg);
    const half = avg % 1 >= 0.5;

    let stars = '‚òÖ'.repeat(full);
    if (half) stars += '‚Ø®';   // half-star look
    stars += '‚òÜ'.repeat(5 - stars.length);

    starsEl.textContent = stars;
    textEl.textContent = `${avg.toFixed(1)} Rated (${count})`;
}

document.addEventListener('DOMContentLoaded', function() {
    loadAverageRating();
});

/* Check Rating Eligibility */
async function checkRatingEligibility() {
    try {
        const response = await fetch('/api/bookings/check-rating-eligibility', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const result = await response.json();
        return result.eligible || false;
    } catch (error) {
        console.error('Error checking rating eligibility:', error);
        return false;
    }
}

/* Populate Booking Selector */
async function populateBookingSelector() {
    try {
        const response = await fetch('/api/bookings/user/completed', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const result = await response.json();

        if (result.success && result.bookings) {
            const selector = document.getElementById('bookingSelector');
            selector.innerHTML = '<option value="">Select a completed booking...</option>';

            result.bookings.forEach(booking => {
                if (!booking.already_rated) {
                    const option = document.createElement('option');
                    option.value = booking._id;
                    option.textContent = `${booking.event_date} - ${booking.service_type} (${booking.guests} guests)`;
                    selector.appendChild(option);
                }
            });
        }
    } catch (error) {
        console.error('Error populating booking selector:', error);
    }
}

/* Show Ineligibility Modal */
function showIneligibilityModal() {
    const modal = document.createElement('div');
    modal.id = 'ineligibilityModal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.75);
        backdrop-filter: blur(8px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: modalFadeIn 0.3s ease-out;
    `;

    modal.innerHTML = `
        <div style="
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 40px;
            border-radius: 24px;
            max-width: 480px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25), 0 0 0 1px rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        ">
            <button onclick="closeIneligibilityModal()" style="
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(100, 116, 139, 0.1);
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-size: 20px;
                cursor: pointer;
                color: #64748B;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                backdrop-filter: blur(10px);
            " onmouseover="this.style.background='rgba(100, 116, 139, 0.2)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(100, 116, 139, 0.1)'; this.style.transform='scale(1)'">√ó</button>

            <div style="margin-bottom: 24px;">
                <div style="
                    width: 80px;
                    height: 80px;
                    background: linear-gradient(135deg, #64748B, #475569);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 auto 20px;
                    box-shadow: 0 8px 25px rgba(100, 116, 139, 0.3);
                    animation: iconBounce 0.6s ease-out;
                ">
                    <span style="font-size: 32px; color: white;">‚è≥</span>
                </div>
                <h2 style="
                    margin-bottom: 12px;
                    color: #1e293b;
                    font-size: 28px;
                    font-weight: 800;
                    background: linear-gradient(135deg, #64748B, #475569);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                ">Complete a Booking First</h2>
                <p style="
                    color: #64748B;
                    margin-bottom: 32px;
                    font-size: 16px;
                    line-height: 1.5;
                    max-width: 320px;
                    margin-left: auto;
                    margin-right: auto;
                ">
                    You need to complete at least one booking before you can leave a rating. Book our services and experience our quality firsthand!
                </p>
            </div>

            <div style="display: flex; gap: 12px; justify-content: center;">
                <button onclick="closeIneligibilityModal()" style="
                    background: rgba(100, 116, 139, 0.1);
                    color: #64748B;
                    border: 2px solid #e2e8f0;
                    padding: 12px 24px;
                    border-radius: 12px;
                    font-weight: 600;
                    font-size: 14px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                " onmouseover="this.style.background='rgba(100, 116, 139, 0.2)'; this.style.borderColor='#cbd5e1'" onmouseout="this.style.background='rgba(100, 116, 139, 0.1)'; this.style.borderColor='#e2e8f0'">Maybe Later</button>
                <a href="/services" style="
                    background: linear-gradient(135deg, #C2410C, #F97316);
                    color: white;
                    text-decoration: none;
                    padding: 12px 24px;
                    border-radius: 12px;
                    font-weight: 600;
                    font-size: 14px;
                    display: inline-block;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(194, 65, 12, 0.3);
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(194, 65, 12, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(194, 65, 12, 0.3)'">Book Now</a>
            </div>
        </div>
    `;

    document.body.appendChild(modal);
}

function closeIneligibilityModal() {
    const modal = document.getElementById('ineligibilityModal');
    if (modal) {
        modal.remove();
    }
}

/* Rating Modal Functions */
async function openRatingModal() {
    // Create modal if it doesn't exist
    if (!document.getElementById('ratingModal')) {
        createRatingModal();
    }

    // Check if user is eligible to rate
    const eligible = await checkRatingEligibility();

    if (!eligible) {
        // Show ineligibility message
        showIneligibilityModal();
        return;
    }

    // Populate booking selector with completed bookings
    await populateBookingSelector();

    document.getElementById('ratingModal').style.display = 'flex';
}

function createRatingModal() {
    const modal = document.createElement('div');
    modal.id = 'ratingModal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.75);
        backdrop-filter: blur(8px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: modalFadeIn 0.3s ease-out;
    `;

    modal.innerHTML = `
        <div style="
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 40px;
            border-radius: 24px;
            max-width: 480px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25), 0 0 0 1px rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        ">
            <button onclick="closeRatingModal()" style="
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(100, 116, 139, 0.1);
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-size: 20px;
                cursor: pointer;
                color: #64748B;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                backdrop-filter: blur(10px);
            " onmouseover="this.style.background='rgba(100, 116, 139, 0.2)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(100, 116, 139, 0.1)'; this.style.transform='scale(1)'">√ó</button>

            <div style="margin-bottom: 24px;">
                <div style="
                    width: 80px;
                    height: 80px;
                    background: linear-gradient(135deg, #C2410C, #F97316);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 auto 20px;
                    box-shadow: 0 8px 25px rgba(194, 65, 12, 0.3);
                    animation: iconBounce 0.6s ease-out;
                ">
                    <span style="font-size: 32px; color: white;">‚≠ê</span>
                </div>
                <h2 style="
                    margin-bottom: 12px;
                    color: #1e293b;
                    font-size: 28px;
                    font-weight: 800;
                    background: linear-gradient(135deg, #C2410C, #F97316);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                ">Rate Our Service</h2>
                <p style="
                    color: #64748B;
                    margin-bottom: 32px;
                    font-size: 16px;
                    line-height: 1.5;
                    max-width: 320px;
                    margin-left: auto;
                    margin-right: auto;
                ">
                    Your feedback helps us serve you better. How was your experience?
                </p>
            </div>

            <div style="
                margin-bottom: 24px;
                text-align: left;
            ">
                <label for="bookingSelector" style="
                    display: block;
                    font-size: 14px;
                    font-weight: 600;
                    color: #374151;
                    margin-bottom: 8px;
                ">Select Booking to Rate:</label>
                <select id="bookingSelector" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                    background: white;
                    color: #374151;
                    cursor: pointer;
                    transition: border-color 0.2s ease;
                " onchange="this.style.borderColor='#fbbf24'">
                    <option value="">Select a completed booking...</option>
                </select>
            </div>

            <div style="
                display: flex;
                gap: 12px;
                margin-bottom: 32px;
                justify-content: center;
                flex-wrap: wrap;
            " id="ratingStarsContainer">
                <button class="rating-star" data-rating="1" title="Poor">
                    <span class="star-icon">‚òÜ</span>
                    <span class="star-label">Poor</span>
                </button>
                <button class="rating-star" data-rating="2" title="Fair">
                    <span class="star-icon">‚òÜ</span>
                    <span class="star-label">Fair</span>
                </button>
                <button class="rating-star" data-rating="3" title="Good">
                    <span class="star-icon">‚òÜ</span>
                    <span class="star-label">Good</span>
                </button>
                <button class="rating-star" data-rating="4" title="Great">
                    <span class="star-icon">‚òÜ</span>
                    <span class="star-label">Great</span>
                </button>
                <button class="rating-star" data-rating="5" title="Excellent">
                    <span class="star-icon">‚òÜ</span>
                    <span class="star-label">Excellent</span>
                </button>
            </div>

            <button id="submitRatingBtn" onclick="submitUserRating()" style="
                background: linear-gradient(135deg, #C2410C, #F97316);
                color: white;
                border: none;
                padding: 16px 32px;
                border-radius: 12px;
                font-weight: 700;
                font-size: 16px;
                cursor: pointer;
                width: 100%;
                display: none;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(194, 65, 12, 0.3);
                position: relative;
                overflow: hidden;
            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(194, 65, 12, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(194, 65, 12, 0.3)'">
                <span id="submitBtnText">Submit Rating</span>
                <div id="submitBtnLoader" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            </button>

            <div id="ratingMessage" style="
                margin-top: 20px;
                font-size: 14px;
                font-weight: 500;
                min-height: 20px;
                opacity: 0;
                transition: opacity 0.3s ease;
            "></div>
        </div>
    `;

    document.body.appendChild(modal);

    // Enhanced CSS for rating stars and animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes iconBounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes starPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes ripple {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(4); opacity: 0; }
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes toastSlideOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        .rating-star {
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 16px 12px;
            cursor: pointer;
            color: #94a3b8;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            min-width: 70px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .rating-star::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.1), transparent);
            transition: left 0.5s;
        }

        .rating-star:hover {
            transform: translateY(-4px) scale(1.05);
            border-color: #fbbf24;
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.3);
        }

        .rating-star:hover::before {
            left: 100%;
        }

        .rating-star.selected {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-color: #f59e0b;
            color: white;
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
            animation: starPulse 0.6s ease-out;
        }

        .rating-star.selected .star-icon {
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .rating-star .star-icon {
            font-size: 24px;
            transition: all 0.3s ease;
            display: block;
        }

        .rating-star .star-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
        }

        .rating-star.selected .star-label {
            opacity: 1;
        }

        #ratingMessage.success {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(16, 185, 129, 0.2);
            opacity: 1;
        }

        #ratingMessage.error {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            opacity: 1;
        }

        @media(max-width: 640px) {
            .rating-star {
                padding: 12px 8px;
                min-width: 60px;
            }

            .rating-star .star-icon {
                font-size: 20px;
            }

            .rating-star .star-label {
                font-size: 10px;
            }
        }

        @media(max-width: 480px) {
            .rating-star {
                padding: 10px 6px;
                min-width: 50px;
            }

            .rating-star .star-icon {
                font-size: 18px;
            }

            .rating-star .star-label {
                font-size: 9px;
            }
        }
    `;
    document.head.appendChild(style);

    // Enhanced event listeners for stars
    modal.querySelectorAll('.rating-star').forEach(star => {
        star.addEventListener('click', function() {
            const rating = parseInt(this.dataset.rating);
            selectRating(rating);
        });

        // Add ripple effect on click
        star.addEventListener('mousedown', function(e) {
            const ripple = document.createElement('span');
            ripple.style.cssText = `
                position: absolute;
                border-radius: 50%;
                background: rgba(255,255,255,0.6);
                transform: scale(0);
                animation: ripple 0.6s linear;
                pointer-events: none;
            `;

            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
            ripple.style.top = (e.clientY - rect.top - size/2) + 'px';

            this.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        });
    });
}

function closeRatingModal() {
    const modal = document.getElementById('ratingModal');
    if (modal) {
        modal.style.display = 'none';
    }
}

function selectRating(rating) {
    // Remove selected class from all stars
    document.querySelectorAll('.rating-star').forEach(star => {
        star.classList.remove('selected');
        star.querySelector('.star-icon').textContent = '‚òÜ';
    });

    // Add selected class to clicked stars and animate
    document.querySelectorAll('.rating-star').forEach((star, index) => {
        if (index < rating) {
            star.classList.add('selected');
            star.querySelector('.star-icon').textContent = '‚òÖ';

            // Add sparkle animation
            star.style.animation = 'none';
            setTimeout(() => {
                star.style.animation = 'starPulse 0.6s ease-out';
            }, 10);
        }
    });

    // Store selected rating
    window.selectedRating = rating;

    // Show submit button with animation
    const submitBtn = document.getElementById('submitRatingBtn');
    submitBtn.style.display = 'block';
    submitBtn.style.animation = 'none';
    setTimeout(() => {
        submitBtn.style.animation = 'modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)';
    }, 10);

    // Clear any previous messages
    const messageEl = document.getElementById('ratingMessage');
    messageEl.textContent = '';
    messageEl.className = '';
    messageEl.style.opacity = '0';
}

async function submitUserRating() {
    if (!window.selectedRating) {
        document.getElementById('ratingMessage').textContent = 'Please select a rating first.';
        document.getElementById('ratingMessage').style.color = '#EF4444';
        return;
    }

    // Check if a booking is selected
    const selectedBooking = document.getElementById('bookingSelector').value;
    if (!selectedBooking) {
        document.getElementById('ratingMessage').textContent = 'Please select a booking to rate.';
        document.getElementById('ratingMessage').style.color = '#EF4444';
        return;
    }

    const submitBtn = document.getElementById('submitRatingBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';

    try {
        const response = await fetch('/api/bookings/submit-rating', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                rating: window.selectedRating,
                booking_id: selectedBooking,
                review: `Rated ${window.selectedRating} stars for booking ${selectedBooking}`
            })
        });

        const result = await response.json();

        if (response.ok && result.success) {
            document.getElementById('ratingMessage').textContent = 'Thank you for your feedback! Your rating helps us improve our service.';
            document.getElementById('ratingMessage').style.color = '#10B981';
            submitBtn.style.display = 'none';

            // Show success alert with appropriate message
            alert('Thank you! Your rating has been submitted successfully. We appreciate your feedback!');

            // Update the hero rating display immediately with response data
            if (result.avgRating !== null && result.totalRatings !== null) {
                updateHeroRatingDisplay(result.avgRating, result.totalRatings);
            } else {
                // Fallback to API call if response doesn't have data
                loadAverageRating();
            }

            // Close modal after success
            setTimeout(() => {
                closeRatingModal();
            }, 2000);
        } else {
            document.getElementById('ratingMessage').textContent = result.message || 'Failed to submit rating.';
            document.getElementById('ratingMessage').style.color = '#EF4444';
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Rating';
        }
    } catch (error) {
        console.error('Error submitting rating:', error);
        document.getElementById('ratingMessage').textContent = 'Network error. Please try again.';
        document.getElementById('ratingMessage').style.color = '#EF4444';
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Rating';
    }
}
</script>

</body>
</html>
