<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Select Dishes - Chetan Catering Services</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
:root{
--primary:#EA580C; --secondary:#0F172A; --bg-light:#F8FAFC; --white:#FFFFFF;
--text-dark:#1E293B; --text-gray:#64748B; --border:#E2E8F0;
}
body{font-family:'Inter',sans-serif;background:var(--bg-light);color:var(--text-dark);padding-bottom:140px;}
z
/* HEADER & SIDEBAR */
header{background:var(--white);box-shadow:0 1px 3px rgba(0,0,0,0.1);}
nav{max-width:1200px;margin:auto;padding:0 20px;height:70px;display:flex;align-items:center;justify-content:space-between;}
.logo{font-size:22px;font-weight:700;color:var(--primary);text-decoration:none;}
.menu-btn{font-size:28px;cursor:pointer;display:none;}
.nav-links{display:flex;gap:24px;list-style:none;}
.nav-links a{text-decoration:none;color:var(--text-dark);font-weight:500;font-size:16px;}

/* Sidebar */
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);opacity:0;visibility:hidden;transition:.3s;z-index:90;}
.overlay.active{opacity:1;visibility:visible;}
.sidebar{position:fixed;top:0;left:-260px;width:260px;height:100%;background:#fff;padding:20px;transition:.3s;z-index:100;}
.sidebar.active{left:0;}
.sidebar h3{margin-bottom:20px;}
.sidebar a{display:block;padding:12px 0;text-decoration:none;color:var(--text-dark);font-weight:500;border-bottom:1px solid var(--border);}

/* MOBILE */
@media(max-width:768px){.nav-links{display:none}.menu-btn{display:block;}}

/* CONTAINER */
.container{max-width:1200px;margin:40px auto;padding:0 20px;}
.page-header h1{font-size:28px;margin-bottom:6px;}
.page-header p{color:var(--text-gray);}

/* Loading */
.loading{text-align:center;padding:40px;color:var(--text-gray);}
.error{text-align:center;padding:40px;color:#EF4444;}

/* Filters */
.filters{display:flex;gap:12px;margin:20px 0;overflow-x:auto;}
.filter-btn{padding:10px 24px;border-radius:50px;border:2px solid var(--border);background:var(--white);font-weight:600;cursor:pointer;transition:.2s;white-space:nowrap;}
.filter-btn.active,.filter-btn:hover{background:var(--primary);border-color:var(--primary);color:#fff;}

/* Dish Grid */
.dish-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;}
.dish-card{background:var(--white);border-radius:14px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.08);transform:translateY(20px);opacity:0;animation:fadeUp .6s ease forwards;}
@keyframes fadeUp{to{opacity:1;transform:translateY(0);} }
.dish-card:hover{transform:translateY(-6px);box-shadow:0 16px 30px rgba(0,0,0,0.15);}
.dish-card img{width:100%;height:160px;object-fit:cover;transition:.4s ease;}
.dish-card:hover img{transform:scale(1.05);}
.dish-body{padding:12px;}
.dish-name{font-size:16px;font-weight:600;margin-bottom:4px;}
.dish-price{color:var(--primary);font-weight:700;margin-bottom:4px;}
.dish-type{font-size:12px;color:var(--text-gray);margin-bottom:8px;text-transform:uppercase;}
.quantity-control{display:flex;align-items:center;justify-content:space-between;background:var(--bg-light);border-radius:6px;padding:4px;gap:6px;}
.qty-btn{width:30px;height:30px;border:none;border-radius:6px;background:var(--white);font-size:16px;font-weight:700;color:var(--primary);cursor:pointer;}
.qty-btn:hover{background:var(--primary);color:#fff;}
.qty-input{width:50px;text-align:center;font-weight:600;border-radius:6px;border:1px solid var(--border);padding:3px;}

/* Total Bar */
.total-bar{position:fixed;bottom:0;left:0;right:0;background:var(--white);box-shadow:0 -4px 10px rgba(0,0,0,.15);padding:10px 12px;}
.total-content{max-width:1200px;margin:auto;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;}
.total-info{display:flex;flex-direction:column;gap:3px;font-size:13px;}
.total-info div{font-weight:500;}
.total-info .amount{font-size:18px;font-weight:700;color:var(--primary);}
.btn-proceed, .btn-back{padding:8px 16px;border:none;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;flex:1;min-width:100px;}
.btn-proceed{background:var(--primary);color:#fff;}
.btn-proceed:disabled{opacity:.4;cursor:not-allowed;}
.btn-back{background:#fff;border:1.5px solid var(--primary);color:var(--primary);}

/* Mobile Responsive */
@media(max-width:768px){
.dish-grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px;}
.page-header h1{font-size:24px;}
.total-content{flex-direction:column;align-items:flex-start;}
.total-info{flex-direction:row;justify-content:space-between;width:100%;margin-bottom:6px;}
.btn-proceed,.btn-back{width:48%;margin-top:0;}
}
</style>
</head>
<body>

<header>
<nav>
<a href="/" class="logo">Chetan Catering</a>
<div class="menu-btn" onclick="toggleMenu()">☰</div>
<ul class="nav-links">
<li><a href="/">Home</a></li>
<li><a href="/services">Services</a></li>
<li><a href="/menu">Menu</a></li>
</ul>
</nav>
</header>

<!-- Sidebar -->
<div class="overlay" onclick="toggleMenu()"></div>
<div class="sidebar">
<h3>Menu</h3>
<a href="/">Home</a>
<a href="/services">Services</a>
<a href="/menu">Menu</a>
<a href="/booking">Booking Flow</a>
</div>

<div class="container">
<div class="page-header">
<h1>Select Dishes</h1>
<p>Choose your favorite dishes for the event</p>
</div>

<!-- Filters -->
<div class="filters" id="categoryFilters"></div>


<div id="loadingMessage" class="loading">Loading dishes...</div>
<div id="errorMessage" class="error" style="display:none;"></div>
<div class="dish-grid" id="dishContainer"></div>
</div>

<div class="total-bar">
<div class="total-content">
<div class="total-info">
<div>Total Amount</div>
<div class="amount">₹<span id="totalAmount">0</span></div>
<div><span id="totalItems">0</span> items selected</div>
</div>
<div style="display:flex;gap:8px;width:100%;">
<button class="btn-back" onclick="goBack()">Back</button>
<button class="btn-proceed" id="proceedBtn" disabled>Proceed</button>
</div>
</div>
</div>

<script>
let allDishes = [];
let allCategories = [];
let cart = {};
let activeCategory = "ALL";

async function loadCategories() {
    const res = await fetch('/api/dishes/categories');
    allCategories = await res.json();
    renderCategoryFilters();
}

async function loadDishes() {
    try {
        document.getElementById('loadingMessage').style.display = 'block';
        document.getElementById('errorMessage').style.display = 'none';
        document.getElementById('dishContainer').innerHTML = '';

        const response = await fetch('/api/dishes/');
        const data = await response.json();

        document.getElementById('loadingMessage').style.display = 'none';

        if (data.success && data.dishes) {
            allDishes = data.dishes.map(dish => ({
                id: dish._id,
                name: dish.name,
                price: dish.price,
                category: dish.category,
                img: dish.image_url || "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=800&q=80",
                description: dish.description || ''
            }));

            if (allDishes.length === 0) {
                document.getElementById('errorMessage').textContent = 'No dishes available at the moment.';
                document.getElementById('errorMessage').style.display = 'block';
            } else {
                renderFilteredDishes();
            }
        } else {
            document.getElementById('errorMessage').textContent = 'Failed to load dishes. Please try again.';
            document.getElementById('errorMessage').style.display = 'block';
        }
    } catch (error) {
        console.error('Error loading dishes:', error);
        document.getElementById('loadingMessage').style.display = 'none';
        document.getElementById('errorMessage').textContent = 'Error connecting to server. Please check your connection.';
        document.getElementById('errorMessage').style.display = 'block';
    }
}

function renderCategoryFilters() {
    const container = document.getElementById('categoryFilters');
    container.innerHTML = '';

    // All button
    const allBtn = document.createElement('button');
    allBtn.innerText = 'All';
    allBtn.className = 'filter-btn active';
    allBtn.onclick = () => filterByCategory('ALL', allBtn);
    container.appendChild(allBtn);

    allCategories.forEach(cat => {
        const btn = document.createElement('button');
        btn.innerText = cat.name;
        btn.className = 'filter-btn';
        btn.onclick = () => filterByCategory(cat.name, btn);
        container.appendChild(btn);
    });
}

function filterByCategory(category, btn) {
    activeCategory = category;

    document.querySelectorAll('.filter-btn')
        .forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    renderFilteredDishes();
}

function renderFilteredDishes() {
    let dishesToShow = allDishes;

    if (activeCategory !== "ALL") {
        dishesToShow = allDishes.filter(
            d => d.category === activeCategory
        );
    }

    renderDishes(dishesToShow);
}

function renderDishes(dishes) {
    const container = document.getElementById('dishContainer');
    container.innerHTML = '';

    if (!dishes.length) {
        container.innerHTML = '<p>No dishes found</p>';
        return;
    }

    dishes.forEach((d, i) => {
        const qty = cart[d.id] || 0;

        container.innerHTML += `
            <div class="dish-card" style="animation-delay:${i*0.05}s">
                <img src="${d.img}" alt="${d.name}">
                <div class="dish-body">
                    <div class="dish-name">${d.name}</div>
                    <div class="dish-price">₹${d.price}</div>
                    <div class="quantity-control">
                        <button class="qty-btn" onclick="update('${d.id}',-1)">−</button>
                        <input type="number" min="0" class="qty-input" value="${qty}" onchange="manualUpdate('${d.id}',this.value)">
                        <button class="qty-btn" onclick="update('${d.id}',1)">+</button>
                    </div>
                </div>
            </div>
        `;
    });
    updateTotal();
}

// Quantity buttons
function update(id, val) {
    cart[id] = (cart[id] || 0) + val;
    if (cart[id] <= 0) delete cart[id];
    renderFilteredDishes();
}

// Manual input update
function manualUpdate(id, value) {
    value = parseInt(value);
    if (isNaN(value) || value < 0) value = 0;
    if (value === 0) delete cart[id];
    else cart[id] = value;
    renderFilteredDishes();
}

// Total calculation
function updateTotal() {
    let t = 0, i = 0;
    Object.keys(cart).forEach(id => {
        const d = allDishes.find(x => x.id == id);
        if (d) {
            t += d.price * cart[id];
            i += cart[id];
        }
    });
    document.getElementById('totalAmount').textContent = t;
    document.getElementById('totalItems').textContent = i;
    document.getElementById('proceedBtn').disabled = i === 0;
}

// Filters
function filterVeg(type, btn) {
    currentType = type;
    document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    renderDishes(allDishes);
}

// Navigation
document.getElementById("proceedBtn").addEventListener("click", () => {
    // Store cart with dish details
    const cartWithDetails = {};
    Object.keys(cart).forEach(dishId => {
        const dish = allDishes.find(d => d.id === dishId);
        if (dish) {
            cartWithDetails[dishId] = {
                quantity: cart[dishId],
                name: dish.name,
                price: dish.price,
                meal_type: dish.meal_type
            };
        }
    });
    sessionStorage.setItem("cart", JSON.stringify(cartWithDetails));
    location.href = "/ordersummary";
});

function goBack() { location.href = "/booking"; }

// Sidebar toggle
function toggleMenu() {
    document.querySelector('.sidebar').classList.toggle('active');
    document.querySelector('.overlay').classList.toggle('active');
}

// Initialization order
document.addEventListener('DOMContentLoaded', async () => {
    await loadCategories();
    await loadDishes();
});
</script>
</body>
</html>